let productsDisplayArr=[],metaBoxParams=flatsomeChildMetaboxParams;const shopProductNonce=metaBoxParams.addShopProductNonce,ajaxUrl=metaBoxParams.ajaxUrl,personalShopPostID=metaBoxParams.personalShopPostID,baseUrl=metaBoxParams.baseUrl,personalShopperSearch=function(t){let o,a=!1,e=!1;const s={searchField:document.querySelector(".myronja-search-term"),searchResults:document.querySelector(".myronja-search-results")};function r(r){clearTimeout(o),null==s.searchField.value||a||(s.searchResults.classList.add("myronja-search-results--is-visible"),a=!0),null!=s.searchField.value&&""!=s.searchField.value||!a||(s.searchResults.classList.remove("myronja-search-results--is-visible"),a=!1),e||(s.searchResults.innerHTML='<div class="myronja-loader"></div>',e=!0),o=setTimeout(d,2e3,r)}function d(r){null!=r.target.value&&""!=r.target.value&&(r=r.target.value,r=baseUrl+"/wp-json/wp/v2/product?per_page=50&search="+r,t.getJSON(r,function(r){r.length<=0?s.searchResults.innerHTML="<h2>No Products found.</h2>":(s.searchResults.innerHTML=`
            <h2>Search Results</h2>
            <ul class="myronja-search-results__list">
              ${r.map(r=>{if(r.myronjaProductStockStatus)return`<li class="myronja-search-results__list-item" id="product-item-${r.id}">
                          <figure class="myronja-search-results__product-image"><img src="${r.myronjaProductThumbnailSrc[0]}"></figure>
                          <p class="myronja-search-results__product-brand">${r.myronjaProductBrand}</p>
                          <p class="myronja-search-results__product-title">${r.title.rendered}</p>
                          <p class="myronja-search-results__product-amount">${r.myronjaProductAmount}</p>
                          <p class="myronja-search-results__product-price">${r.myronjaProductPrice}</p>
                          <div class="myronja-search-results__action-wrapper">
                            <a href="#" button class="myronja-add-to-shop button button-primary" id="myronja-add-to-shop-${r.id}"
                            data-product-id="${r.id}"
                            data-product-thumbnail="${r.myronjaProductThumbnailSrc[0]}"
                            data-product-brand="${r.myronjaProductBrand}"
                            data-product-title="${r.title.rendered}"
                            data-product-price="${r.myronjaProductPrice}"
                            data-product-amount="${r.myronjaProductAmount}"
                            data-product-action="add-product">Add Product</a>
                          </div>
                      </li>`}).join("")}
            </ul>`,t(window).trigger("myronjaSearchProductsLoaded"))}),e=!1)}return{init:function(){null!=s.searchField&&s.searchField.addEventListener("input",r)}}}(jQuery),personalShopperAfterProductsLoaded=(personalShopperSearch.init(),function(d){let r=metaBoxParams.personalShopProductIDS;0<r.length&&r.forEach(r=>{null!=d("#myronja-remove-from-shop-"+r)&&productsDisplayArr.push(d("#myronja-remove-from-shop-"+r).data())}),d(window).on("myronjaSearchProductsLoaded",function(){const s={shopProductAddButtons:document.querySelectorAll(".myronja-search-results .myronja-add-to-shop"),shopProductsDisplay:document.querySelector(".myronja-products-display .myronja-products-list")};null!=s.shopProductAddButtons&&s.shopProductAddButtons.forEach(r=>{r.addEventListener("click",e=>{e.preventDefault(),e.target.classList.add("disabled"),e.target.style.pointerEvents="none";var r={action:"personal_shopper_add_user_products_to_meta",nonce:shopProductNonce,productId:e.target.dataset.productId,productAction:e.target.dataset.productAction,personalShopPostID:personalShopPostID};d.post(ajaxUrl,r,function(r,a){if("success"==a){a=e;let r=d(a.target).data(),t=a.target.dataset.productId,o=`
                <li class="myronja-products-item" id="product-item-${t}">
                  <figure class="myronja-products-item__product-image"><img src="${r.productThumbnail}"></figure>
                    <p class="myronja-products-item__product-title">${r.productTitle}</p>
                    <p class="myronja-products-item__product-amount">${r.productAmount}</p>
                    <p class="myronja-products-item__product-price">${r.productPrice}</p>
                    <div class="myronja-products-item__action-wrapper">
								      <a href="#" class="myronja-remove-from-shop button button-primary" id="myronja-remove-from-shop-${t}"
                      data-product-id="${t}"
                      data-product-thumbnail="${r.productThumbnail}"
                      data-product-title="${r.productTitle}"
                      data-product-price="${r.productPrice}"
                      data-product-amount="${r.productAmount}"
                      data-product-action="remove-product">
									      Remove Product
								      </a>
							      </div>
                </li>
              `;0==productsDisplayArr.length&&(s.shopProductsDisplay.insertAdjacentHTML("beforeend",o),productsDisplayArr.push(r));productsDisplayArr.some(r=>parseInt(r.productId)==parseInt(t))||(s.shopProductsDisplay.insertAdjacentHTML("beforeend",o),productsDisplayArr.push(r));d(window).trigger("myronjaProductsLoadedOnDisplay",[a])}})})})})}(jQuery)),personalShopperAfterProductsLoadedOnDisplay=function(t){t(window).on("load myronjaProductsLoadedOnDisplay",function(){let r=document.querySelectorAll(".myronja-products-display .myronja-remove-from-shop"),e=document.querySelector(".myronja-products-display .myronja-products-list");null!=r&&r.forEach(r=>{r.addEventListener("click",o=>{o.preventDefault(),o.target.classList.add("disabled"),o.target.style.pointerEvents="none";var r={action:"personal_shopper_add_user_products_to_meta",nonce:shopProductNonce,productId:o.target.dataset.productId,productAction:o.target.dataset.productAction,personalShopPostID:personalShopPostID};t.post(ajaxUrl,r,function(r,t){if("success"==t){t=o;let a=t.target.dataset.productId,r=document.querySelector(".myronja-products-display #product-item-"+a);productsDisplayArr.forEach((r,t,o)=>{r.productId==a&&o.splice(t,1)}),null!=r&&e.removeChild(r)}})})})})}(jQuery);